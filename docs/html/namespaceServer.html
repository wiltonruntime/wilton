<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>wilton.js: Server Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">wilton.js
   &#160;<span id="projectnumber">v202009291</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Packages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="namespacemembers.html"><span>Package&#160;Functions</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Server Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><b>wilton/Server</b> <br/>
 HTTP server.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8353176ccdddbc5b627afd7a2cd6aa83"><td class="memItemLeft" align="right" valign="top">Undefined&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceServer.html#a8353176ccdddbc5b627afd7a2cd6aa83">broadcastWebSocket</a> (Object options, Function|Undefined callback)</td></tr>
<tr class="memdesc:a8353176ccdddbc5b627afd7a2cd6aa83"><td class="mdescLeft">&#160;</td><td class="mdescRight">Broadcast a message to WebSocket clients.  <a href="#a8353176ccdddbc5b627afd7a2cd6aa83"></a><br/></td></tr>
<tr class="memitem:a2204cc6a7c5811bf02574338a5321e92"><td class="memItemLeft" align="right" valign="top">Undefined&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceServer.html#a2204cc6a7c5811bf02574338a5321e92">getTcpPort</a> (Function|Undefined callback)</td></tr>
<tr class="memdesc:a2204cc6a7c5811bf02574338a5321e92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find out server TCP port.  <a href="#a2204cc6a7c5811bf02574338a5321e92"></a><br/></td></tr>
<tr class="memitem:a86c9ec71adb138c242dee20c68cb2530"><td class="memItemLeft" align="right" valign="top">Object&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceServer.html#a86c9ec71adb138c242dee20c68cb2530">Server</a> (Object options, Function|Undefined callback)</td></tr>
<tr class="memdesc:a86c9ec71adb138c242dee20c68cb2530"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start HTTP server.  <a href="#a86c9ec71adb138c242dee20c68cb2530"></a><br/></td></tr>
<tr class="memitem:a7e5acc0cd99523bb3460f71260a56b13"><td class="memItemLeft" align="right" valign="top">Undefined&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceServer.html#a7e5acc0cd99523bb3460f71260a56b13">stop</a> (Function|Undefined callback)</td></tr>
<tr class="memdesc:a7e5acc0cd99523bb3460f71260a56b13"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop HTTP server.  <a href="#a7e5acc0cd99523bb3460f71260a56b13"></a><br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This module allows to start HTTP servers and handle incoming requests using specified modules/functions.</p>
<p>Each value specified in <code>views</code> parameter, is used both as a name of the module to handle the requests and as an URL path to route the requests to this module.</p>
<p><code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> and <code>OPTIONS</code> (for CORS support) methods are used inside the handler modules to handle incoming requests with the corresponding HTTP method.</p>
<p>Additionally <code>WSOPEN</code>, <code>WSMESSAGE</code> and <code>WSCLOSE</code> WebSocket event names can be used inside hanler modules to handle incoming WebSocket events.</p>
<p><code><a class="el" href="namespaceServer.html" title="wilton/Server   HTTP server.">Server</a></code> can also serve static files (from file-system or from ZIP files) specifying <code>documentRoots</code> configuration parameter.</p>
<p><code><a class="el" href="namespaceServer.html" title="wilton/Server   HTTP server.">Server</a></code> supports HTTPS (certificates must be specified) and can be configured to require client <code>X.509</code> certificates.</p>
<p><code><a class="el" href="namespaceServer.html" title="wilton/Server   HTTP server.">Server</a></code> can be stopped to release system resources using <code><a class="el" href="namespaceServer.html#a7e5acc0cd99523bb3460f71260a56b13" title="Stop HTTP server.">stop()</a></code> method, otherwise it will be stopped during the shutdown.</p>
<p>Usage example:</p>
<div class="fragment"><div class="line"><span class="comment">// inside &quot;index.js&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// start server</span></div>
<div class="line">var server = <span class="keyword">new</span> <a class="code" href="namespaceServer.html#a86c9ec71adb138c242dee20c68cb2530" title="Start HTTP server.">Server</a>({</div>
<div class="line">    tcpPort: 8080,</div>
<div class="line">    views: [</div>
<div class="line">        <span class="stringliteral">&quot;server/views/hi&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;server/views/bye&quot;</span></div>
<div class="line">    ]</div>
<div class="line">});</div>
<div class="line"></div>
<div class="line"><span class="comment">// active URLS:</span></div>
<div class="line"><span class="comment">// http://127.0.0.1:8080/server/views/hi</span></div>
<div class="line"><span class="comment">// http://127.0.0.1:8080/server/views/bye</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// wait for Ctrl+C (in console app)</span></div>
<div class="line">misc.waitForSignal();</div>
<div class="line"></div>
<div class="line"><span class="comment">// stop server</span></div>
<div class="line">server.stop();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">// inside &quot;server/views/hi.js&quot;</span></div>
<div class="line"></div>
<div class="line">GET: <span class="keyword">function</span>(req) {</div>
<div class="line">    req.sendResponse(<span class="stringliteral">&quot;hello from GET handler&quot;</span>);</div>
<div class="line">},</div>
<div class="line"></div>
<div class="line">POST: <span class="keyword">function</span>(req) {</div>
<div class="line">    req.sendResponse({</div>
<div class="line">        msg: <span class="stringliteral">&quot;hello from POST handler&quot;</span></div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --> </div><h2>Function Documentation</h2>
<a class="anchor" id="a8353176ccdddbc5b627afd7a2cd6aa83"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Undefined Server::broadcastWebSocket </td>
          <td>(</td>
          <td class="paramtype">Object&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Function|Undefined&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Broadcasts the message to all the WebSocket clients currently connected on the specified <code>path</code>.</p>
<p>May cause the broadcast message to interleave with other frames (put in the middle of continuation sequence, or in the middle to TCP fragmented sequence), if target connection is used for outbound traffic at the the time of broadcast.</p>
<p>List of clients to include into broadcast may be specified directly using <code>idList</code> option.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">options</td><td><code>Object</code> configuration object, see possible options below </td></tr>
    <tr><td class="paramname">callback</td><td><code>Function|Undefined</code> callback to receive result or error </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>Undefined</code></dd></dl>
<p><b>Options</b></p>
<ul>
<li><b>path</b> <code>String</code> WebSocket path to broadcast on</li>
<li><b>message</b> <code>String|Object</code> message to send, specified <code>Object</code> will be converted to JSON</li>
<li><b>idList</b> <code>Array|Undefined</code> optional list of WebSocket client IDs to include into the broadcast </li>
</ul>

</div>
</div>
<a class="anchor" id="a2204cc6a7c5811bf02574338a5321e92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Undefined Server::getTcpPort </td>
          <td>(</td>
          <td class="paramtype">Function|Undefined&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Retuns a TCP port number that this server instance is bound to.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td><code>Function|Undefined</code> callback to receive result or error </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>Undefined</code> </dd></dl>

</div>
</div>
<a class="anchor" id="a86c9ec71adb138c242dee20c68cb2530"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Object Server::Server </td>
          <td>(</td>
          <td class="paramtype">Object&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Function|Undefined&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Starts HTTP server binding the connection on a specified TCP port. <a class="el" href="namespaceServer.html" title="wilton/Server   HTTP server.">Server</a> worker threads are run in background.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">options</td><td><code>Object</code> configuration object, see possible options below </td></tr>
    <tr><td class="paramname">callback</td><td><code>Function|Undefined</code> callback to receive result or error </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>Object</code> <code><a class="el" href="namespaceSerial.html" title="wilton/Serial   Connect to hardware devices using serial protocol.">Serial</a></code> instance</dd></dl>
<p><b>Options</b></p>
<ul>
<li><b>views</b> <code>Array</code> list of module names that will be used to handle incoming request; the same module names are also used as URL paths for requiests routing; functions with following names are used inside the handler module to handle the requests:<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> and <code>OPTIONS</code>; the following method names can be used for WebSocket events: <code>WSOPEN</code>, <code>WSMESSAGE</code> and <code>WSCLOSE</code>; each handler function receives <code><a class="el" href="namespaceRequest.html" title="wilton/Request   HTTP requests handling for wilton/Server.">Request</a></code> instance as an only parameter and must use <code>sendResponse()</code>, <code>sendTempFile()</code>, <code>sendMustache()</code> or <code>sendWebSocket()</code> methods to return the response to client;</li>
<li><b>filters</b> <code>Array</code> list of module names that will be called on the incoming request, each module must return a <code>function(req, doFilter)</code>, and can either call <code>doFilter(req)</code> to proceed to the next filter (and eventually - to the request view), or handle the request with <code>sendResponse()</code></li>
<li><b>numberOfThreads</b> <code>Number|Undefined</code> number of background threads to start, default value: <code>2</code></li>
<li><b>tcpPort</b> <code>Number|Undefined</code> TCP port to bind to, default value: <code>8080</code></li>
<li><b>ipAddress</b> <code>String|Undefined</code> IP address to bind to, default value: <code>0.0.0.0</code></li>
<li><b>ssl</b> <code>Object|Undefined</code> HTTPS configuration<ul>
<li><b>keyFile</b> <code>String</code> path to SSL certificate file that must also contain a private key</li>
<li><b>keyPassword</b> <code>String</code> SSL server certificate (private key) password</li>
<li><b>verifyFile</b> <code>String|Undefined</code> path to SSL CA certificate to use for validation of client <code>X.509</code> certificate</li>
<li><b>verifySubjectSubstr</b> <code>String|Undefined</code> substring of the client <code>X.509</code> certificate subject that will be checked during the client certificate check</li>
</ul>
</li>
<li><b>documentRoots</b> <code>Array|Undefined</code> configuration for serving static files<ul>
<li><b>resource</b> <code>String</code> URL path for this entry</li>
<li><b>dirPath</b> <code>String|Undefined</code> path to file-system directory to serve files from</li>
<li><b>zipPath</b> <code>String|Undefined</code> path to ZIP file to server files from</li>
<li><b>zipInnerPrefix</b><code>String|Undefined</code> prefix to strip from ZIP paths when serving files from ZIP</li>
<li><b>useResourceLoader</b><code>Boolean|Undefined</code> whether to load response resources through <code>wilton_loader</code>; default value: false</li>
<li><b>resourceLoaderPrefix</b><code>String|Undefined</code> prefix (absolute path to WLIB file and optional internal path) to prepend to resources paths</li>
<li><b>cacheMaxAgeSeconds</b> <code>Number|Undefined</code> value for <code>Cache-Control</code>'s <code>max-age</code> field to use for files server from this <code>documentRoot</code>, in seconds, default value: <code>604800</code></li>
<li><b>mimeTypes</b> <code>Array|Undefined</code> list of MIME types mapping for this <code>documentRoot</code><ul>
<li><b>extension</b> <code>String</code> file extension (<code>CSS</code>, <code>JS</code> etc)</li>
<li><b>mime</b> <code>String</code> MIME type for this extension</li>
</ul>
</li>
</ul>
</li>
<li><b>requestPayload</b> <code>Object|Undefined</code> configuration for handling requests payload<ul>
<li><b>tmpDirPath</b> <code>String</code> path to the directory where temporary files with requests payloads will be stored</li>
<li><b>tmpFilenameLen</b> <code>Number|Undefined</code> length of the generated random names for temporary files, default value: <code>32</code></li>
<li><b>memoryLimitBytes</b> <code>Number|Undefined</code> max size of the request payload that is allowed to process in-memory without dumping it into file, in bytes, default value: <code>1048576</code></li>
</ul>
</li>
<li><b>mustache</b> <code>Object</code> configuration for <a href="https://mustache.github.io/">mustache</a> responses<ul>
<li><b>partialsDirs</b> <code>Array</code> list of directories to use for loading mustache partial templates when returning rendered mustache templates using <code><a class="el" href="namespaceRequest.html#a574fe938e31444d4ddef382c3b471987" title="Send rendered mustache template to client.">Request.sendMustache()</a></code></li>
</ul>
</li>
<li><b>handle</b> <code>Number|Undefined</code> handle to access <code><a class="el" href="namespaceServer.html" title="wilton/Server   HTTP server.">Server</a></code> instance from another thread </li>
</ul>

</div>
</div>
<a class="anchor" id="a7e5acc0cd99523bb3460f71260a56b13"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Undefined Server::stop </td>
          <td>(</td>
          <td class="paramtype">Function|Undefined&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stops HTTP server releasing system resources, active servers will be stopped automatically on shutdown.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td><code>Function|Undefined</code> callback to receive result or error </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>Undefined</code> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 29 2020 10:05:56 for wilton.js by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
